# BinaryTrans - 二进制代码翻译与验证平台

BinaryTrans是一个综合性的二进制代码翻译与验证平台，专注于不同架构之间（主要是ARM64与x86_64）的代码转换与正式验证。本项目由两个主要组件构成：CodeGen（代码翻译引擎）和Formal Verify（形式化验证工具），共同实现高效准确的跨架构二进制代码转换流程。

## 项目组成

BinaryTrans项目包含以下主要组件：

1. **CodeGen**: 基于深度学习的二进制代码翻译引擎，能够将一种架构的汇编代码翻译成另一种架构的等价代码。
2. **Formal Verify**: 形式化验证工具，用于验证翻译前后代码的语义等价性。

## 环境要求

- Python 3.7+
- PyTorch 1.7+
- CUDA 10.2+（GPU加速，推荐）
- Binary Ninja（用于二进制代码分析）
- angr, claripy（用于形式化验证）
- capstone, keystone-engine（用于汇编/反汇编）
- NetworkX, NumPy, scikit-learn等科学计算库

## 快速开始

### 安装

1. 克隆仓库：

```bash
git clone <repository_url>
cd binarytrans
```

2. 安装依赖：

```bash
pip install -r requirements.txt
```

3. 安装特定组件依赖：

```bash
# 安装CodeGen依赖
pip install -r codegen/requirements.txt

# 安装形式化验证依赖
pip install angr claripy capstone keystone-engine
```

### 使用流程概览

BinaryTrans的典型使用流程包括：代码翻译（使用CodeGen）和翻译结果验证（使用Formal Verify）。

## CodeGen - 代码翻译引擎

CodeGen是一个基于深度学习的二进制代码转换工具，使用Transformer架构实现高效的跨架构代码翻译。

### 核心功能

- **多架构支持**：支持ARM64与x86_64架构间的双向翻译
- **控制流分析**：通过CFG（控制流图）分析保持程序结构
- **数据流分析**：通过DFG（数据流图）分析保持数据依赖关系
- **深度学习模型**：使用改进的Transformer架构进行序列到序列的转换

### 使用步骤

1. **数据生成**：生成数据流图和控制流图用于训练
2. **编码器训练**：训练能够编码二进制指令的模型
3. **数据集准备**：准备ARM-x86对应的翻译数据集
4. **翻译模型训练**：训练序列到序列的翻译模型
5. **代码翻译**：使用训练好的模型进行代码翻译

详细使用说明请参考[CodeGen文档](codegen/README.md)。

## Formal Verify - 形式化验证工具

Formal Verify是一套验证工具，用于确认翻译前后代码的语义等价性，确保翻译的正确性。

### 核心功能

- **精确验证**：使用符号执行技术精确验证指令等价性
- **启发式验证**：对复杂指令序列使用启发式方法判断
- **综合验证模式**：结合多种方法对指令序列进行分析
- **批量与交互式验证**：支持批量和交互式指令验证

### 使用步骤

1. **安装验证依赖**：安装angr、claripy等验证所需库
2. **规则文件验证**：使用预定义规则文件验证代码对
3. **交互式验证**：手动输入代码进行等价性验证

详细使用说明请参考[Formal Verify文档](formal_verify/README.md)。

## 完整工作流程

BinaryTrans的完整工作流程如下：

1. **源代码分析**：使用Binary Ninja分析源架构二进制文件
2. **图表示生成**：生成控制流图和数据流图
3. **编码器训练**：训练编码器模型表示汇编指令
4. **翻译数据准备**：准备源架构到目标架构的映射数据
5. **翻译模型训练**：训练端到端的翻译模型
6. **代码翻译**：使用训练好的模型进行代码翻译
7. **形式化验证**：验证翻译结果的语义等价性
8. **输出优化**：对翻译结果进行优化，提高执行效率

## 示例

### 代码翻译示例

```
# ARM指令 (输入)
add x0, x1, x2
lsl x3, x0, #2

# 翻译后的x86指令 (输出)
lea rdi, [rsi + rdx]
shl rbx, 2
```

### 验证示例

使用形式化验证工具验证上述翻译结果：

```bash
python formal_verify/combined_verify.py
```

选择交互式输入模式，输入ARM和x86代码，验证工具将判断它们是否语义等价。

## 应用场景

BinaryTrans适用于以下场景：

- **跨平台软件移植**：加速软件在不同架构间的移植过程
- **遗留代码迁移**：将旧架构上的程序迁移到新架构
- **安全分析**：辅助不同架构二进制代码的安全分析
- **性能优化**：通过架构转换获得更优的性能表现

## 贡献指南

欢迎对BinaryTrans项目进行贡献！您可以通过以下方式参与：

1. 提交Issue报告Bug或提出新功能建议
2. 提交Pull Request贡献代码
3. 完善文档和示例

## 许可证

本项目采用MIT许可证。详细信息请参见LICENSE文件。

## 联系方式

如有问题或建议，请通过以下方式联系我们：

- 提交GitHub Issue
- 发送邮件至：[您的邮箱]

---

BinaryTrans项目旨在推动跨架构二进制代码转换技术的发展，欢迎研究者和开发者一起完善这一工具链！ 